<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Bitcoin Trivia Question</title>
    <script src='https://www.unpkg.com/nostr-login@latest/dist/unpkg.js' integrity="sha384-PLACEHOLDER" crossorigin="anonymous" data-perms='sign_event:13374' data-theme='default'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #f7931a;
            color: white;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .form-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #555;
        }
        
        input[type="text"],
        input[type="email"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #f7931a;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .options-group {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .option-input label {
            margin-bottom: 0;
            margin-right: 0.5rem;
            min-width: 30px;
        }
        
        .radio-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .radio-group label {
            font-weight: normal;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        button {
            background-color: #f7931a;
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #e8821a;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #1976d2;
            margin-bottom: 0.5rem;
        }
        
        .difficulty-scale {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        #submissionStatus {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .nostr-auth-section {
            background: #f5f5f5;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .nostr-info {
            display: none;
            background: #e8f4e8;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            border: 1px solid #c3e6c3;
        }
        
        .nostr-info.show {
            display: block;
        }
        
        .nostr-pubkey {
            font-family: monospace;
            font-size: 0.85rem;
            word-break: break-all;
            margin-top: 0.5rem;
            color: #666;
        }
        
        #nostr-login-button {
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° Bitcoin Trivia Submission</h1>
            <p>Contribute your Bitcoin knowledge to our trivia game!</p>
        </header>
        
        <div class="form-container">
            <div class="nostr-auth-section">
                <h3>üîê Login with Nostr (Optional)</h3>
                <p>Connect your Nostr account to submit questions and track your contributions</p>
                <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">You can still submit questions without logging in</p>
                <div id="nostr-login-button"></div>
                <div id="nostr-info" class="nostr-info">
                    <strong>Connected as:</strong>
                    <div id="nostr-username"></div>
                    <div id="nostr-pubkey" class="nostr-pubkey"></div>
                </div>
            </div>
            
            <div class="info-box">
                <h3>üìù Submission Guidelines</h3>
                <ul>
                    <li>Questions should be factual and verifiable</li>
                    <li>Include a clear explanation for the correct answer</li>
                    <li>Difficulty 1-3: Basic concepts, 4-7: Intermediate, 8-10: Expert level</li>
                    <li>All submissions will be reviewed before inclusion</li>
                </ul>
            </div>
            
            <form id="submissionForm">
                <div class="form-group">
                    <label for="question">Question*</label>
                    <textarea id="question" name="question" required placeholder="Enter your Bitcoin trivia question..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Answer Options*</label>
                    <div class="options-group">
                        <div class="option-input">
                            <label for="option_a">A:</label>
                            <input type="text" id="option_a" name="option_a" required placeholder="First option">
                        </div>
                        <div class="option-input">
                            <label for="option_b">B:</label>
                            <input type="text" id="option_b" name="option_b" required placeholder="Second option">
                        </div>
                        <div class="option-input">
                            <label for="option_c">C:</label>
                            <input type="text" id="option_c" name="option_c" required placeholder="Third option">
                        </div>
                        <div class="option-input">
                            <label for="option_d">D:</label>
                            <input type="text" id="option_d" name="option_d" required placeholder="Fourth option">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Correct Answer*</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="correct_answer" value="a" required>
                            Option A
                        </label>
                        <label>
                            <input type="radio" name="correct_answer" value="b" required>
                            Option B
                        </label>
                        <label>
                            <input type="radio" name="correct_answer" value="c" required>
                            Option C
                        </label>
                        <label>
                            <input type="radio" name="correct_answer" value="d" required>
                            Option D
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="difficulty">Difficulty Level* (1-10)</label>
                    <select id="difficulty" name="difficulty" required>
                        <option value="">Select difficulty</option>
                        <option value="1">1 - Very Easy</option>
                        <option value="2">2 - Easy</option>
                        <option value="3">3 - Easy-Medium</option>
                        <option value="4">4 - Medium</option>
                        <option value="5">5 - Medium</option>
                        <option value="6">6 - Medium-Hard</option>
                        <option value="7">7 - Hard</option>
                        <option value="8">8 - Very Hard</option>
                        <option value="9">9 - Expert</option>
                        <option value="10">10 - Expert (Trick Question)</option>
                    </select>
                    <div class="difficulty-scale">
                        1-3: Basic Bitcoin concepts | 4-7: Technical knowledge | 8-10: Deep expertise required
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="category">Category*</label>
                    <select id="category" name="category" required>
                        <option value="">Select category</option>
                        <option value="History">History</option>
                        <option value="Technology">Technology</option>
                        <option value="Mining">Mining</option>
                        <option value="Economics">Economics</option>
                        <option value="Security">Security</option>
                        <option value="Network">Network</option>
                        <option value="Development">Development</option>
                        <option value="Privacy">Privacy</option>
                        <option value="Culture">Culture</option>
                        <option value="Transactions">Transactions</option>
                        <option value="Basics">Basics</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="explanation">Explanation*</label>
                    <textarea id="explanation" name="explanation" required placeholder="Explain why this is the correct answer and provide context..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="submitted_by">Your Name/Username*</label>
                    <input type="text" id="submitted_by" name="submitted_by" required placeholder="How should we credit you?">
                    <small style="color: #666; margin-top: 0.25rem; display: block;">This will be auto-filled if you're logged in with Nostr</small>
                </div>
                
                <div class="form-group">
                    <label for="email">Email (optional)</label>
                    <input type="email" id="email" name="email" placeholder="For notification when approved">
                </div>
                
                <button type="submit">Submit Question</button>
                
                <div id="submissionStatus"></div>
            </form>
        </div>
    </div>
    
    <script>
        // Nostr authentication state
        let nostrUser = null;
        
        // Listen for Nostr auth events
        document.addEventListener('nlAuth', async (e) => {
            if (e.detail.type === 'login' || e.detail.type === 'signup') {
                // User logged in
                try {
                    const pubkey = await window.nostr.getPublicKey();
                    nostrUser = {
                        pubkey: pubkey,
                        npub: nip19Encode(pubkey)
                    };
                    
                    // Update UI
                    document.getElementById('nostr-info').classList.add('show');
                    document.getElementById('nostr-pubkey').textContent = `npub: ${nostrUser.npub}`;
                    
                    // Try to get profile info
                    try {
                        const profile = await getNostrProfile(pubkey);
                        if (profile) {
                            document.getElementById('nostr-username').textContent = profile.name || profile.display_name || 'Anonymous';
                            // Auto-fill the submitted_by field
                            document.getElementById('submitted_by').value = profile.name || profile.display_name || '';
                        }
                    } catch (err) {
                        console.log('Could not fetch profile:', err);
                        document.getElementById('nostr-username').textContent = 'Anonymous';
                    }
                } catch (err) {
                    console.error('Error getting pubkey:', err);
                }
            } else if (e.detail.type === 'logout') {
                // User logged out
                nostrUser = null;
                document.getElementById('nostr-info').classList.remove('show');
                document.getElementById('submitted_by').value = '';
            }
        });
        
        // Helper function to encode pubkey to npub format
        function nip19Encode(pubkey) {
            // Simple npub encoding (in production, use proper nip19 library)
            return 'npub1' + pubkey.substring(0, 12) + '...';
        }
        
        // Helper function to get Nostr profile (simplified)
        async function getNostrProfile(pubkey) {
            // In a real implementation, this would query Nostr relays
            // For now, return null
            return null;
        }
        
        document.getElementById('submissionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const statusDiv = document.getElementById('submissionStatus');
            
            const submission = {
                id: 'sub_' + Date.now(),
                question: formData.get('question'),
                options: {
                    a: formData.get('option_a'),
                    b: formData.get('option_b'),
                    c: formData.get('option_c'),
                    d: formData.get('option_d')
                },
                correct_answer: formData.get('correct_answer'),
                difficulty: parseInt(formData.get('difficulty')),
                category: formData.get('category'),
                explanation: formData.get('explanation'),
                submitted_by: formData.get('submitted_by'),
                email: formData.get('email'),
                created_at: new Date().toISOString(),
                status: 'pending',
                // Add Nostr pubkey if logged in
                nostr_pubkey: nostrUser ? nostrUser.pubkey : null
            };
            
            try {
                // In a real implementation, this would submit to a backend or GitHub API
                // For now, we'll create a GitHub issue
                const issueBody = `
**New Trivia Question Submission**

**Question:** ${submission.question}

**Options:**
- A: ${submission.options.a}
- B: ${submission.options.b}
- C: ${submission.options.c}
- D: ${submission.options.d}

**Correct Answer:** ${submission.correct_answer.toUpperCase()}

**Difficulty:** ${submission.difficulty}/10
**Category:** ${submission.category}

**Explanation:** ${submission.explanation}

**Submitted by:** ${submission.submitted_by}
${submission.email ? `**Email:** ${submission.email}` : ''}
${submission.nostr_pubkey ? `**Nostr pubkey:** ${submission.nostr_pubkey}` : ''}

---
*Submission ID: ${submission.id}*
                `.trim();
                
                // Show success message
                statusDiv.className = 'success';
                statusDiv.textContent = 'Thank you! Your question has been submitted for review. An admin will review it shortly.';
                statusDiv.style.display = 'block';
                
                // Log the submission data (in production, this would be sent to backend)
                console.log('Submission data:', submission);
                console.log('GitHub issue body:', issueBody);
                
                // Reset form
                e.target.reset();
                
                // Scroll to status message
                statusDiv.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.textContent = 'Error submitting question. Please try again later.';
                statusDiv.style.display = 'block';
                console.error('Submission error:', error);
            }
        });
    </script>
</body>
</html>